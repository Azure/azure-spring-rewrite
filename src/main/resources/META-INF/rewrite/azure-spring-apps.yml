#
# Copyright 2021 the original author or authors.
# <p>
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://www.apache.org/licenses/LICENSE-2.0
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
---
type: specs.openrewrite.org/v1beta/recipe

name: com.azure.spring.migration.openrewrite.WindowsFilePath
displayName: Remove Windows file path in application
description: Find file system path which is Microsoft Windows platform dependent. It needs to be replaced with a Linux-style path
tags:
  - cloud
  - azure
  - mordernize
recipeList:
  - com.azure.spring.migration.openrewrite.java.search.FindLiterals:
      pattern: '[A-z]:([\\\/][^\n\t]+)+|(\\\\([^\\\,\n\t]+)\\\S+)+'
      mark: "TODO ASA-WindowsFilePath: this file system path is Microsoft Windows platform dependent"
---
type: specs.openrewrite.org/v1beta/recipe

name: com.azure.spring.migration.openrewrite.FileStorageApi
displayName: Find uses of Java file IO API
description: >
  Find usages of Java APIs to read/write from the file system.
  Any usage of the file system on the application will require reconfiguration https://learn.microsoft.com/en-us/azure/developer/java/migration/migrate-spring-cloud-to-azure-spring-apps?pivots=sc-standard-tier#determine-whether-and-how-the-file-system-is-used
tags:
  - java-fileIO
recipeList:
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.File <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.File createNewFile(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.File createTempFile(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.FileInputStream <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.FileOutputStream <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.FileReader <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.FileWriter <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.BufferedReader <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.BufferedWriter <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.BufferedReader read(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.BufferedReader readLine(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.BufferedWriter <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.BufferedWriter write(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.BufferedWriter newLine(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.InputStreamReader <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.OutputStreamWriter <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.ObjectInputStream <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.io.ObjectOutputStream <constructor>(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files createFile(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files createTempFile(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files readAllLines(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files readAllBytes(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files newBufferedReader(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files newInputStream(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files write(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files newBufferedWriter(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files newOutputStream(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files copy(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.nio.file.Files move(..)'
      matchOverrides: true
      mark: "TODO ASA-FileStorageApi: need configuration to use storage"

---
type: specs.openrewrite.org/v1beta/recipe

name: com.azure.spring.migration.openrewrite.FindFileScheme
displayName: Find file scheme.
description: >
  Find file scheme.
  Any usage of the file system on the application will require reconfiguration https://learn.microsoft.com/en-us/azure/developer/java/migration/migrate-spring-cloud-to-azure-spring-apps?pivots=sc-standard-tier#determine-whether-and-how-the-file-system-is-used
tags:
  - java-fileSystem
recipeList:
  - com.azure.spring.migration.openrewrite.java.search.FindLiterals:
      pattern: 'file:(//.*)?/.+'
      mark: "TODO ASA-FileStoragePath: need configuration to use file system"

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.Springboot_2_x
displayName: Migrate to Spring boot 2.7.X
description:  >
  Migrate applications built on previous versions of Spring Boot to the latest Spring Boot 2.7 release.
tags:
  - spring boot
  - azure
  - mordernize
recipeList:
  - com.azure.spring.migration.openrewrite.Springboot_2_6
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.7.x
      overrideManagedVersion: false
      retainVersions:
        - mysql:mysql-connector-java
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.7.x
      retainVersions:
        - mysql:mysql-connector-java
  # Use recommended replacements for deprecated APIs
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.web.server.LocalServerPort
      newFullyQualifiedTypeName: org.springframework.boot.test.web.server.LocalServerPort
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.actuate.autoconfigure.web.server.LocalManagementPort
      newFullyQualifiedTypeName: org.springframework.boot.test.web.server.LocalManagementPort
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.rsocket.context.LocalRSocketServerPort
      newFullyQualifiedTypeName: org.springframework.boot.test.rsocket.server.LocalRSocketServerPort
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy
      newFullyQualifiedTypeName: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_7
  # Switch MySQL driver artifactId
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: mysql
      oldArtifactId: mysql-connector-java
      newGroupId: com.mysql
      newArtifactId: mysql-connector-j
      newVersion: 8.0.x

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.Springboot_2_6
displayName: Migrate to Spring boot 2.6.X
description:  >
tags:
  - spring boot
  - azure
  - mordernize
recipeList:
  - com.azure.spring.migration.openrewrite.Springboot_2_5
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.6.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.6.x
  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_6

  # Upgrade spring-cloud-dependencies release train
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: "spring-cloud-dependencies"
      newVersion: 2021.0.X
      overrideManagedVersion: false

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.Springboot_2_5
displayName: Migrate to Spring boot 2.5.X
description:  >
tags:
  - spring boot
  - azure
  - mordernize
recipeList:
  - com.azure.spring.migration.openrewrite.Springboot_2_4
  - org.openrewrite.java.spring.data.UpgradeSpringData_2_5
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.5.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.5.x
  - org.openrewrite.java.spring.boot2.MigrateDatabaseCredentials

  # Use recommended replacements for deprecated APIs
  - org.openrewrite.java.spring.boot2.MigrateActuatorMediaTypeToApiVersion
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.autoconfigure.data.jpa.EntityManagerFactoryDependsOnPostProcessor
      newFullyQualifiedTypeName: org.springframework.boot.autoconfigure.orm.jpa.EntityManagerFactoryDependsOnPostProcessor
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.boot.autoconfigure.web.ResourceProperties
      newFullyQualifiedTypeName: org.springframework.boot.autoconfigure.web.WebProperties$Resources

  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_5

#  # Initialization ordering
#  - org.openrewrite.java.spring.boot2.DatabaseComponentAndBeanInitializationOrdering

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.Springboot_2_4
displayName: Migrate to Spring boot 2.4.X
description:  >
tags:
  - spring boot
  - azure
  - mordernize
recipeList:
  - com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_3
  - org.openrewrite.java.spring.framework.UpgradeSpringFramework_5_3
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.4.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.4.x
  - org.openrewrite.maven.RemoveExclusion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-test
      exclusionGroupId: org.junit.vintage
      exclusionArtifactId: junit-vintage-engine
  - org.openrewrite.maven.RemoveExclusion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-test
      exclusionGroupId: junit
      exclusionArtifactId: junit

  # Use recommended replacements for deprecated APIs
  - org.openrewrite.java.spring.boot2.MigrateUndertowServletWebServerFactoryIsEagerInitFilters
  - org.openrewrite.java.spring.boot2.MigrateUndertowServletWebServerFactorySetEagerInitFilters
  - org.openrewrite.java.spring.boot2.MigrateLoggingSystemPropertyConstants
  - org.openrewrite.java.spring.boot2.MigrateHsqlEmbeddedDatabaseConnection

  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_4

# SpringBoot 2.3
---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_3
displayName: Migrate to Spring Boot 2.3
description: >
  Migrate applications to the latest Spring Boot 2.3 release. This recipe will modify an
  application's build files, make changes to deprecated/preferred APIs, and migrate configuration settings that have
  changes between versions. This recipe will also chain additional framework migrations (Spring Framework, Spring Data,
  etc) that are required as part of the migration to Spring Boot 2.3.
tags:
  - spring
  - boot
recipeList:
  - com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_2
  - org.openrewrite.java.spring.data.UpgradeSpringData_2_3
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.3.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.3.x
  # https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.3-Release-Notes#validation-starter-no-longer-included-in-web-starters
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-validation
      version: 2.3.x
      onlyIfUsing: javax.validation.constraints.*
      acceptTransitive: true

  # Use recommended replacements for deprecated APIs
  - org.openrewrite.java.spring.boot2.MigrateRestClientBuilderCustomizerPackageName
  - org.openrewrite.java.spring.boot2.MigrateErrorPropertiesIncludeStackTraceConstants
  - org.openrewrite.java.spring.boot2.GetErrorAttributes

  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_3

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_2
displayName: Migrate to Spring Boot 2.2
description: >
  Migrate applications to the latest Spring Boot 2.2 release. This recipe will modify an
  application's build files, make changes to deprecated/preferred APIs, and migrate configuration settings that have
  changes between versions. This recipe will also chain additional framework migrations (Spring Framework, Spring Data,
  etc) that are required as part of the migration to Spring Boot 2.2.
tags:
  - spring
  - boot
recipeList:
  - com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_1
  - org.openrewrite.java.spring.framework.UpgradeSpringFramework_5_2
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.2.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.2.x

  # Use recommended replacements for deprecated APIs
  - org.openrewrite.java.spring.boot2.MigrateApplicationHealthIndicatorToPingHealthIndicator
  - org.openrewrite.java.spring.boot2.MigrateWebTestClientBuilderCustomizerPackageName
  - org.openrewrite.java.spring.boot2.MigrateConfigurationPropertiesBindingPostProcessorValidatorBeanName

  - org.openrewrite.java.spring.boot2.SpringBootMavenPluginMigrateAgentToAgents

  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_2

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_1
displayName: Migrate to Spring Boot 2.1
description: >
  Migrate applications to the latest Spring Boot 2.1 release. This recipe will modify an
  application's build files, make changes to deprecated/preferred APIs, and migrate configuration settings that have
  changes between versions. This recipe will also chain additional framework migrations (Spring Framework, Spring Data,
  etc) that are required as part of the migration to Spring Boot 2.1.
tags:
  - spring
  - boot
recipeList:
  - com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_0
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.1.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.1.x

  # Use recommended replacements for deprecated APIs
  - org.openrewrite.java.spring.boot2.MigrateRestTemplateBuilderBasicAuthorization
  - org.openrewrite.java.spring.boot2.MigrateRestTemplateBuilderTimeoutByInt
  - org.openrewrite.java.spring.boot2.MigrateMultipartConfigFactory

  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_1

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.UpgradeSpringBoot_2_0
displayName: Migrate to Spring Boot 2.0
description: >
  Migrate applications to the latest Spring Boot 2.0 release. This recipe will modify an
  application's build files, make changes to deprecated/preferred APIs, and migrate configuration settings that have
  changes between versions. This recipe will also chain additional framework migrations (Spring Framework, Spring Data,
  etc) that are required as part of the migration to Spring Boot 2.0.
tags:
  - spring
  - boot
recipeList:
  # Upgrade 2.0.x from 1.x
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.boot
      artifactId: "*"
      newVersion: 2.0.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.boot
      artifactId: spring-boot-starter-parent
      newVersion: 2.0.x
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.mockito
      artifactId: "*"
      newVersion: 3.x
      overrideManagedVersion: false
  - org.openrewrite.maven.RemoveProperty:
      propertyName: thymeleaf.version
  - org.openrewrite.java.dependencies.RemoveDependency:
      groupId: org.webjars
      artifactId: webjars-locator
  - org.openrewrite.java.spring.boot2.MigrateToWebServerFactoryCustomizer
  - org.openrewrite.java.spring.framework.UpgradeSpringFramework_5_0
  - org.openrewrite.java.spring.boot2.MigrateSpringBootServletInitializerPackageName
  - org.openrewrite.java.spring.boot2.MigrateHttpMessageConvertersPackageName
  - org.openrewrite.java.spring.boot2.MigrateErrorControllerPackageName
  - org.openrewrite.java.spring.boot2.MigrateHibernateConstraintsToJavax
  - org.openrewrite.java.spring.boot2.MigrateLocalServerPortAnnotation
  # Update properties
  - org.openrewrite.java.spring.boot2.SpringBootProperties_2_0
  - org.openrewrite.java.spring.boot2.SpringBoot2BestPractices

---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.SpringCloud_2021
displayName: Migrate to Spring Cloud 2021.0.X
description:  >
  Migrate to Spring Cloud 2021.0.X. This recipe will modify an application's build files.
tags:
  - spring cloud
  - azure
  - mordernize
recipeList:
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-dependencies
      newVersion: 2021.0.X
      overrideManagedVersion: true
---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.AddCommentInLogging
displayName: Add comment for enabling logging to console
tags:
  - logging
recipeList:
  - com.azure.spring.migration.openrewrite.xml.AddConsoleCommentInLogback:
      commentText: &loggingComment "TODO ASA-CheckLogging: Enable logging to console"
      fileMatcher: "**/logback{-*,}.xml"
  - com.azure.spring.migration.openrewrite.xml.AddConsoleCommentInLog4j:
      commentText: *loggingComment
      fileMatcher: "**/log{4j,4j2}{-*,}.xml"
---
type: specs.openrewrite.org/v1beta/recipe

name: com.azure.spring.migration.openrewrite.JavaSystemConfig
displayName: Find uses of Java System Config
description: >
  Review usage of environment variables and system properties and externalize. Configure environment variables or jvm options in azure spring apps
  http://aka.ms/spring-boot-to-asa?toc=%2Fazure%2Fspring-apps%2Ftoc.json&bc=%2Fazure%2Fspring-apps%2Fbreadcrumb%2Ftoc.json#configure-per-service-secrets-and-externalized-settings
tags:
  - systemConfig
recipeList:
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.lang.System getenv(..)'
      matchOverrides: true
      flow: null
      mark: "TODO ASA-JavaSystemConfig: need environment variables configuration in azure spring apps"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.lang.System getProperty(..)'
      matchOverrides: true
      flow: null
      mark: "TODO ASA-JavaSystemConfig: review usage of system properties and externalize by configuring jvm options in azure spring apps"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.lang.System setProperties(..)'
      matchOverrides: true
      flow: null
      mark: "TODO ASA-JavaSystemConfig: review usage of system properties and externalize by configuring jvm options in azure spring apps"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.lang.System setProperty(..)'
      matchOverrides: true
      flow: null
      mark: "TODO ASA-JavaSystemConfig: review usage of system properties and externalize by configuring jvm options in azure spring apps"
---
type: specs.openrewrite.org/v1beta/recipe

name: com.azure.spring.migration.openrewrite.JavaSystemLoad
displayName: Find uses of Java System Load
description: >
  Remediate to cloud friendly implentation. It may not work on ASA
tags:
  - systemLoad
recipeList:
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.lang.System loadLibrary(..)'
      matchOverrides: true
      flow: null
      mark: "TODO ASA-JavaSystemLoad: need to mount your own storage and upload your binary code"
  - com.azure.spring.migration.openrewrite.java.search.FindMethods:
      methodPattern: 'java.lang.System load(..)'
      matchOverrides: true
      flow: null
      mark: "TODO ASA-JavaSystemLoad: need to mount your own storage and upload your binary code"
---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.FindPassword
displayName: Find password keyword in yaml and properties
tags:
  - config
recipeList:
  - com.azure.spring.migration.openrewrite.yaml.FindProperty:
      propertyKey: '*password'
      commentText: &passwordComment "TODO ASA-FindPassword: Don't save passwords or login information in files"
  - com.azure.spring.migration.openrewrite.yaml.FindProperty:
      propertyKey: '*userid'
      commentText: *passwordComment
  - com.azure.spring.migration.openrewrite.properties.AddCommentToProperty:
      propertyKey: '*password'
      commentText: *passwordComment
  - com.azure.spring.migration.openrewrite.properties.AddCommentToProperty:
      propertyKey: '*userid'
      commentText: *passwordComment
---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.openrewrite.FindEurekaConfigConnectionInfo
displayName: Find eureka and config server connection info in yaml and properties
tags:
  - config
recipeList:
  - com.azure.spring.migration.openrewrite.yaml.FindProperty:
      propertyKey: '*eureka.client.serviceUrl'
      commentText: &eurekaConfigComment "TODO ASA-EurekaConfigServer: ASA will inject the eureka/config server connection info upon app start"
  - com.azure.spring.migration.openrewrite.yaml.FindProperty:
      propertyKey: '*spring.config.import'
      commentText: *eurekaConfigComment
  - com.azure.spring.migration.openrewrite.yaml.FindProperty:
      propertyKey: '*spring.cloud.config.uri'
      commentText: *eurekaConfigComment
  - com.azure.spring.migration.openrewrite.properties.AddCommentToProperty:
      propertyKey: '*eureka.client.serviceUrl'
      commentText: &eurekaConfigComment "TODO ASA-EurekaConfigServer: ASA will inject the eureka/config server connection info upon app start"
  - com.azure.spring.migration.openrewrite.properties.AddCommentToProperty:
      propertyKey: '*spring.config.import'
      commentText: *eurekaConfigComment
  - com.azure.spring.migration.openrewrite.properties.AddCommentToProperty:
      propertyKey: '*spring.cloud.config.uri'
      commentText: *eurekaConfigComment

########################################################################################################################
---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.UpgradeToAzureSpringApps
displayName: Migrate to Azure Spring Apps
description: Migrate to Azure Spring Apps
recipeList:
  - com.azure.spring.migration.openrewrite.WindowsFilePath
  - com.azure.spring.migration.openrewrite.FindFileScheme
  - com.azure.spring.migration.openrewrite.FileStorageApi
  - com.azure.spring.migration.openrewrite.AddCommentInLogging
  - com.azure.spring.migration.openrewrite.FindEurekaConfigConnectionInfo
  - com.azure.spring.migration.openrewrite.FindPassword
  - com.azure.spring.migration.openrewrite.JavaSystemLoad
  - com.azure.spring.migration.openrewrite.JavaSystemConfig


---
type: specs.openrewrite.org/v1beta/recipe
name: com.azure.spring.migration.UpgradeSpringboot_2_7_SpringCloud_2021
displayName: Migrate to Springboot_2_7 and SpringCloud_2021
description: Migrate to Springboot_2_7 and SpringCloud_2021
recipeList:
  - com.azure.spring.migration.openrewrite.Springboot_2_x
  - com.azure.spring.migration.openrewrite.SpringCloud_2021



